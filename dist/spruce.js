"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e,t){return function(e,t){e.exports=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e){var t,r=e.replace(/^v/,"").replace(/\+.*$/,""),s=-1===(t=r).indexOf("-")?t.length:t.indexOf("-"),n=r.substring(0,s).split(".");return n.push(r.substring(s+1)),n}function r(e){return isNaN(Number(e))?e:Number(e)}function s(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function n(e,n){[e,n].forEach(s);for(var i=t(e),o=t(n),a=0;a<Math.max(i.length-1,o.length-1);a++){var c=parseInt(i[a]||0,10),u=parseInt(o[a]||0,10);if(c>u)return 1;if(u>c)return-1}var h=i[i.length-1],f=o[o.length-1];if(h&&f){var d=h.split(".").map(r),l=f.split(".").map(r);for(a=0;a<Math.max(d.length,l.length);a++){if(void 0===d[a]||"string"==typeof l[a]&&"number"==typeof d[a])return-1;if(void 0===l[a]||"string"==typeof d[a]&&"number"==typeof l[a])return 1;if(d[a]>l[a])return 1;if(l[a]>d[a])return-1}}else if(h||f)return h?-1:1;return 0}var i=[">",">=","=","<","<="],o={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return n.validate=function(t){return"string"==typeof t&&e.test(t)},n.compare=function(e,t,r){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===i.indexOf(e))throw new TypeError("Invalid operator, expected one of "+i.join("|"))}(r);var s=n(e,t);return o[r].indexOf(s)>-1},n}()}(t={exports:{}}),t.exports}(),t=function(e){return null==e},r=function(e){return Object.getPrototypeOf(e)===Object.prototype},s=function(e){return Array.isArray(e)},n=function(e,i){return Object.entries(e).forEach(function(o){var a=o[0],c=o[1];t(c)||!r(c)&&!s(c)||(e[a]=n(c,i))}),new Proxy(e,{get:function(e,t,r){return i.get(e,t,r)},set:function(e,s,o,a){return!t(o)&&r(o)&&(o=n(o,i)),i.set(e,s,e[s]=o,a),!0}})},i={stores:{},persistenceDriver:window.localStorage,persisted:[],subscribers:[],watchers:{},disableReactivity:!1,startingCallbacks:[],startedCallbacks:[],hasStarted:!1,start:function(){var e=this;this.startingCallbacks.forEach(function(e){return e()}),this.attach(),this.stores=n(this.stores,{get:function(t,r,s){return["get","set","toggle","clear"].includes(r)?e[r].bind(e):Reflect.get(t,r,s)},set:function(t,r,s,n){if(!e.disableReactivity){e.updateSubscribers(),e.runWatchers(t,r,s,n),e.disableReactivity=!0;try{e.persisted.forEach(e.updateLocalStorage.bind(e))}catch(e){}e.disableReactivity=!1}}}),this.hasStarted=!0,this.disableReactivity=!0,Object.entries(this.watchers).forEach(function(t){var r=t[0];t[1].forEach(function(t){return e.watch(r,t)})}),this.disableReactivity=!1,this.startedCallbacks.forEach(function(e){return e()})},starting:function(e){this.startingCallbacks.push(e)},started:function(e){this.startedCallbacks.push(e)},attach:function(){if(!(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")||window.Alpine&&e.compare(window.Alpine.version,"2.7.0",">=")))throw new Error("[Spruce] You must be using Alpine >= 2.5.0 to use Spruce.");var t=this;window.Alpine.addMagicProperty("store",function(e){return t.subscribe(e),t.stores})},store:function(e,t,r){if(void 0===r&&(r=!1),"function"==typeof t&&(t=t()),r)try{this.stores[e]=this.retrieveFromLocalStorage(e,(s={},Object.entries(t).filter(function(e){return"function"==typeof e[1]}).forEach(function(e){return s[e[0]]=e[1]}),s)),this.persisted.includes(e)||this.persisted.push(e)}catch(e){}var s;return this.stores[e]||(this.stores[e]=t),this.stores[e]},reset:function(e,t){this.runWatchers(this.stores[e],"__self",t),t.__watchers||(t.__watchers=this.stores[e].__watchers),this.stores[e]=t},subscribe:function(e){return this.subscribers.includes(e)||this.subscribers.push(e),this.stores},updateSubscribers:function(){this.subscribers.filter(function(e){return!!e.__x}).forEach(function(e){e.__x.updateElements(e)})},retrieveFromLocalStorage:function(e,t){void 0===t&&(t={});var r=this.persistenceDriver.getItem("__spruce:"+e);if(!r)return null;var s=JSON.parse(r);return"object"==typeof s&&(delete(s=Object.assign(t,s)).__watchers,delete s.__key_name),s},updateLocalStorage:function(e){var t=this.store(e);delete t.__watchers,delete t.__key_name,this.persistenceDriver.setItem("__spruce:"+e,JSON.stringify(this.store(e)))},get:function(e,t){return void 0===t&&(t=this.stores),e.split(".").reduce(function(e,t){return e[t]},t)},set:function(e,t,r){return void 0===r&&(r=this.stores),s(e)||(e=e.split(".")),1===e.length?r[e[0]]=t:r[e[0]]?this.set(e.slice(1),t,r[e[0]]):(r[e[0]]={},this.set(e.slice(1),t,r[e[0]]))},toggle:function(e){return this.set(e,!this.get(e))},clear:function(e){return this.persistenceDriver.removeItem("__spruce:"+e)},watch:function(e,n){if(!this.hasStarted)return this.watchers[e]||(this.watchers[e]=[]),void this.watchers[e].push(n);var i=e.split("."),o=i.reduce(function(e,n){var i=e[n];return t(i)||!r(i)&&!s(i)?e:i},this.stores),a=Object.is(o,this.get(e))?"__self":i[i.length-1];o.__watchers||(o.__watchers=new Map),o.__watchers.has(a)||o.__watchers.set(a,new Set),o.__watchers.get(a).add(n)},runWatchers:function(e,t,r){e.__watchers&&(e.__watchers.has(t)&&"__self"!==t&&e.__watchers.get(t).forEach(function(e){return e(r)}),e.__watchers.has("__self")&&e.__watchers.get("__self").forEach(function(e){return e(r,t)}))},persistUsing:function(e){if(this.persisted.length>0&&console.warn("[Spruce] You have already initialised a persisted store. Changing the driver may cause issues."),"function"!=typeof e.getItem)throw new Error("[Spruce] The persistence driver must have a `getItem(key)` method.");if("function"!=typeof e.setItem)throw new Error("[Spruce] The persistence driver must have a `setItem(key, value)` method.");if("function"!=typeof e.removeItem)throw new Error("[Spruce] The persistence driver must have a `removeItem(name)` method.");this.persistenceDriver=e}};window.Spruce=i;var o=window.deferLoadingAlpine||function(e){e()};window.deferLoadingAlpine=function(e){window.Spruce.start(),o(e)},module.exports=i;
//# sourceMappingURL=spruce.js.map
