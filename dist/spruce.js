"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t=function(t,e){return function(t,e){t.exports=function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function e(t){var e,r=t.replace(/^v/,"").replace(/\+.*$/,""),s=-1===(e=r).indexOf("-")?e.length:e.indexOf("-"),i=r.substring(0,s).split(".");return i.push(r.substring(s+1)),i}function r(t){return isNaN(Number(t))?t:Number(t)}function s(e){if("string"!=typeof e)throw new TypeError("Invalid argument expected string");if(!t.test(e))throw new Error("Invalid argument not valid semver ('"+e+"' received)")}function i(t,i){[t,i].forEach(s);for(var n=e(t),o=e(i),a=0;a<Math.max(n.length-1,o.length-1);a++){var c=parseInt(n[a]||0,10),u=parseInt(o[a]||0,10);if(c>u)return 1;if(u>c)return-1}var f=n[n.length-1],h=o[o.length-1];if(f&&h){var d=f.split(".").map(r),l=h.split(".").map(r);for(a=0;a<Math.max(d.length,l.length);a++){if(void 0===d[a]||"string"==typeof l[a]&&"number"==typeof d[a])return-1;if(void 0===l[a]||"string"==typeof d[a]&&"number"==typeof l[a])return 1;if(d[a]>l[a])return 1;if(l[a]>d[a])return-1}}else if(f||h)return f?-1:1;return 0}var n=[">",">=","=","<","<="],o={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.validate=function(e){return"string"==typeof e&&t.test(e)},i.compare=function(t,e,r){!function(t){if("string"!=typeof t)throw new TypeError("Invalid operator type, expected string but got "+typeof t);if(-1===n.indexOf(t))throw new TypeError("Invalid operator, expected one of "+n.join("|"))}(r);var s=i(t,e);return o[r].indexOf(s)>-1},i}()}(e={exports:{}}),e.exports}(),e=function(t){return null==t},r=function(t){return Object.getPrototypeOf(t)===Object.prototype},s=function(t){return Array.isArray(t)},i=function(t,n){return Object.entries(t).forEach(function(o){var a=o[0],c=o[1];e(c)||!r(c)&&!s(c)||(t[a]=i(c,n))}),new Proxy(t,{set:function(t,s,o,a){return!e(o)&&r(o)&&(o=i(o,n)),n.set(t,s,t[s]=o,a),!0}})},n={stores:{},persistenceDriver:window.localStorage,persisted:[],subscribers:[],watchers:{},disableReactivity:!1,startingCallbacks:[],startedCallbacks:[],hasStarted:!1,start:function(){var t=this;this.startingCallbacks.forEach(function(t){return t()}),this.attach(),this.stores=i(this.stores,{set:function(e,r,s,i){if(!t.disableReactivity){t.updateSubscribers(),t.runWatchers(e,r,s,i),t.disableReactivity=!0;try{t.persisted.forEach(t.updateLocalStorage.bind(t))}catch(t){}t.disableReactivity=!1}}}),this.hasStarted=!0,this.disableReactivity=!0,Object.entries(this.watchers).forEach(function(e){var r=e[0];e[1].forEach(function(e){return t.watch(r,e)})}),this.disableReactivity=!1,this.startedCallbacks.forEach(function(t){return t()})},starting:function(t){this.startingCallbacks.push(t)},started:function(t){this.startedCallbacks.push(t)},attach:function(){if(!(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")||window.Alpine&&t.compare(window.Alpine.version,"2.7.0",">=")))throw new Error("[Spruce] You must be using Alpine >= 2.5.0 to use Spruce.");var e=this;window.Alpine.addMagicProperty("store",function(t){return e.subscribe(t),e.stores})},store:function(t,e,r){if(void 0===r&&(r=!1),"function"==typeof e&&(e=e()),r)try{this.stores[t]=this.retrieveFromLocalStorage(t,(s={},Object.entries(e).filter(function(t){return"function"==typeof t[1]}).forEach(function(t){return s[t[0]]=t[1]}),s)),this.persisted.includes(t)||this.persisted.push(t)}catch(t){}var s;return this.stores[t]||(this.stores[t]=e),this.stores[t]},reset:function(t,e){this.stores[t]=e},subscribe:function(t){return this.subscribers.includes(t)||this.subscribers.push(t),this.stores},updateSubscribers:function(){this.subscribers.filter(function(t){return!!t.__x}).forEach(function(t){t.__x.updateElements(t)})},retrieveFromLocalStorage:function(t,e){void 0===e&&(e={});var r=this.persistenceDriver.getItem("__spruce:"+t);if(!r)return null;var s=JSON.parse(r);return"object"==typeof s&&(delete(s=Object.assign(e,s)).__watchers,delete s.__key_name),s},updateLocalStorage:function(t){var e=this.store(t);delete e.__watchers,delete e.__key_name,this.persistenceDriver.setItem("__spruce:"+t,JSON.stringify(this.store(t)))},get:function(t){return t.split(".").reduce(function(t,e){return t[e]},this.stores)},set:function(t,e,r){return r||(r=this.stores),s(t)||(t=t.split(".")),1===t.length?r[t[0]]=e:r[t[0]]?this.set(t.slice(1),e,r[t[0]]):(r[t[0]]={},this.set(t.slice(1),e,r[t[0]]))},toggle:function(t){return this.set(t,!this.get(t))},watch:function(t,i){if(!this.hasStarted)return this.watchers[t]||(this.watchers[t]=[]),void this.watchers[t].push(i);var n=t.split("."),o=n.reduce(function(t,i){var n=t[i];return e(n)||!r(n)&&!s(n)?t:n},this.stores),a=Object.is(o,this.get(t))?"__self":n[n.length-1];o.__watchers||(o.__watchers=new Map),o.__watchers.has(a)||o.__watchers.set(a,new Set),o.__watchers.get(a).add(i)},runWatchers:function(t,e,r){t.__watchers&&(t.__watchers.has(e)&&t.__watchers.get(e).forEach(function(t){return t(r)}),t.__watchers.has("__self")&&t.__watchers.get("__self").forEach(function(t){return t(r,e)}))},persistUsing:function(t){if(this.persisted.length>0&&console.warn("[Spruce] You have already initialised a persisted store. Changing the driver may cause issues."),"function"!=typeof t.getItem)throw new Error("[Spruce] The persistence driver must have a `getItem(key)` method.");if("function"!=typeof t.setItem)throw new Error("[Spruce] The persistence driver must have a `setItem(key, value)` method.");this.persistenceDriver=t}};window.Spruce=n;var o=window.deferLoadingAlpine||function(t){t()};window.deferLoadingAlpine=function(t){window.Spruce.start(),o(t)},module.exports=n;
//# sourceMappingURL=spruce.js.map
